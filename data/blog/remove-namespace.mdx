---
title: Removendo um Namespace em estado terminanting
date: '2024-07-15'
tags: ['kubernetes']
draft: false
summary: O erro de namespace em estado ‚ÄúTerminating‚Äù ocorre quando um namespace (ou espa√ßo de nomes) no Kubernetes est√° sendo desligado ou exclu√≠do.
---

# Removendo um Namespace em Estado Terminanting

O erro de namespace em estado ‚ÄúTerminating‚Äù ocorre quando um namespace (ou espa√ßo de nomes) no Kubernetes est√° sendo desligado ou exclu√≠do. Vamos explorar os detalhes desse erro:

**Contexto:**
Um namespace √© uma unidade l√≥gica de isolamento que agrupa recursos no Kubernetes.
Quando voc√™ exclui um namespace, o Kubernetes inicia um processo de t√©rmino para limpar todos os recursos associados a ele.

**Fase de T√©rmino:**
Durante a fase de t√©rmino, o namespace entra no estado ‚ÄúTerminating‚Äù.
Nesse estado, o Kubernetes come√ßa a desalocar os recursos dentro do namespace.
Isso inclui a exclus√£o de pods, services, deployments, configmaps, secrets e outros objetos relacionados.

**Recursos em T√©rmino:**
Os recursos dentro do namespace em t√©rmino s√£o marcados para exclus√£o.
O Kubernetes aguarda at√© que todos esses recursos sejam removidos com sucesso.
Se algum recurso estiver preso ou n√£o puder ser exclu√≠do, o namespace permanecer√° no estado ‚ÄúTerminating‚Äù.

**Poss√≠veis Causas:**

- Pods Pendentes: Se houver pods pendentes (que n√£o podem ser encerrados), o namespace n√£o poder√° ser completamente exclu√≠do.
- Volumes Persistentes: Volumes persistentes associados a pods podem impedir o t√©rmino do namespace.
- Controladores de Recursos: Controladores como Deployments, StatefulSets ou DaemonSets tamb√©m podem afetar o t√©rmino.

**Solu√ß√µes:**

- Verifique os pods pendentes e tente corrigir quaisquer problemas.
- Garanta que os volumes persistentes sejam liberados.
- Analise os controladores de recursos e seus recursos associados.

Lembre-se de que o estado ‚ÄúTerminating‚Äù √© tempor√°rio e, uma vez que todos os recursos sejam removidos com sucesso, o namespace ser√° exclu√≠do completamente. üöÄ

## Caso n√£o consiga remover recursos "presos" no namespace, tente a solu√ß√£o abaixo:

1. Salve um arquivo JSON como no exemplo a seguir:

```
kubectl get ns zabbix -o json > tempfile.json
```

O conte√∫do do arquivo ser√° algo como:

```
{
    "apiVersion": "v1",
    "kind": "Namespace",
    "metadata": {
        "annotations": {
            "cattle.io/status": "{\"Conditions\":[{\"Type\":\"ResourceQuotaInit\",\"Status\":\"True\",\"Message\":\"\",\"LastUpdateTime\":\"2024-04-23T13:55:17Z\"},{\"Type\":\"InitialRolesPopulated\",\"Status\":\"True\",\"Message\":\"\",\"LastUpdateTime\":\"2024-04-23T13:55:18Z\"}]}",
            "field.cattle.io/containerDefaultResourceLimit": "{}",
            "field.cattle.io/projectId": "c-m-zrkmsvsf:p-cssw8",
            "lifecycle.cattle.io/create.namespace-auth": "true"
        },
        "creationTimestamp": "2024-04-23T13:55:16Z",
        "finalizers": [
            "controller.cattle.io/namespace-auth"
        ],
        "labels": {
            "field.cattle.io/projectId": "p-cssw8",
            "kubernetes.io/metadata.name": "zabbix"
        },
        "name": "zabbix",
        "resourceVersion": "111297880",
        "uid": "81f426de-3a70-4078-86de-a07e30b408b3"
    },
    "spec": {
        "finalizers": [
            "kubernetes"
        ]
    },
    "status": {
        "phase": "Active"
    }
}
```

2. Remova o bloco de finalizadores na se√ß√£o spec do JSON:

```
"spec" : {
    }
```

3. Aplique as mudan√ßas com o comando a seguir:

```
kubectl replace --raw "/api/v1/namespaces/TERMINATING_NAMESPACE/finalize" -f ./tempfile.json
```

4. Verifique se o namespace em quest√£o foi removido:

```
kubectl get namespaces
```
