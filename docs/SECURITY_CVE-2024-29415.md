# CVE-2024-29415: ip Package SSRF Vulnerability

## Overview

**CVE ID**: CVE-2024-29415  
**GHSA ID**: GHSA-2p57-rm9w-gvfp  
**Severity**: High  
**Status**: Mitigated (2025-12-30)

## Vulnerability Description

The `ip` package through version 2.0.1 for Node.js contains an SSRF (Server-Side Request Forgery) vulnerability due to improper categorization of IP addresses in the `isPublic()` function.

### Affected IP Addresses

The following IP addresses are incorrectly categorized as globally routable when they should be identified as private/local:

- `127.1`
- `01200034567`
- `012.1.2.3`
- `000:0:0000::01`
- `::fFFf:127.0.0.1`

### Root Cause

This vulnerability exists because of an **incomplete fix** for CVE-2023-42282. The original vulnerability was addressed in version 2.0.1, but the fix did not cover all edge cases of IP address notation.

## Impact

If the `isPublic()` function is used to validate IP addresses in security-sensitive contexts (such as protecting against SSRF attacks), malicious actors could bypass these protections by using alternate IP address notations.

## Patched Version

**None available** - As of the date of mitigation, there is no patched version of the `ip` package. The upstream package has `first_patched_version: null` in the GitHub Advisory Database.

## Mitigation Strategy

Since there is no patched version available and the `ip` package is not directly used in this project, we have implemented the following mitigation:

1. **Removed forced resolution**: Removed `"ip": "2.0.1"` from the `resolutions` field in `package.json`
2. **Dependency management**: The `ip` package was only present as a transitive dependency (not directly imported)
3. **Verification**: Confirmed that the package is no longer in the dependency tree after removal

### Files Changed

- `package.json`: Removed `ip` from resolutions
- `yarn.lock`: Updated to reflect the removal
- `SECURITY.md`: Added documentation about the vulnerability and mitigation

## Verification

After implementing the mitigation:

```bash
# Verify ip package is no longer in dependency tree
yarn why ip
# Expected: "ip" not found in lockfile / dependency tree

# Verify no ip vulnerabilities in audit
yarn npm audit --all | grep "ip "
# Expected: no matches
```

## Alternative Packages

If IP address validation or manipulation is needed in the future, consider these well-maintained alternatives:

- **ipaddr.js** (v2.3.0): Recommended alternative with active maintenance
- **ip-address** (v10.1.0): Comprehensive IPv4/IPv6 address library
- **is-ip** (v5.0.1): Simple IP address validation

## References

- [GitHub Advisory GHSA-2p57-rm9w-gvfp](https://github.com/advisories/GHSA-2p57-rm9w-gvfp)
- [CVE-2024-29415](https://nvd.nist.gov/vuln/detail/CVE-2024-29415)
- [Original vulnerability CVE-2023-42282](https://github.com/advisories/GHSA-78xj-cgh5-2h22)
- [GitHub Issue #150](https://github.com/indutny/node-ip/issues/150)
- [Pull Request #143](https://github.com/indutny/node-ip/pull/143)
- [Pull Request #144](https://github.com/indutny/node-ip/pull/144)

## Timeline

- **2024-02-08**: CVE-2023-42282 published and fixed in ip@2.0.1
- **2024-05-27**: CVE-2024-29415 published (incomplete fix discovered)
- **2024-06-02**: GitHub Security Advisory published
- **2025-12-31**: Mitigation implemented in this project

## Security Best Practices

When dealing with IP address validation:

1. Always use well-maintained libraries with active security monitoring
2. Never rely solely on client-provided IP addresses for security decisions
3. Implement multiple layers of validation
4. Keep dependencies updated and monitor security advisories
5. Consider using allowlists instead of denylists when possible

## Contact

For security concerns, please refer to our [Security Policy](../SECURITY.md).
